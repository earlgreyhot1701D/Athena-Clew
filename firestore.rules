rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /sessions/{sessionId} {
      // Allow get/write for MVP (client-side sessionId matching)
      // For V2: Add authentication check: request.auth != null
      // BLOCKED: 'list' is implicitly denied to prevent enumeration
      allow get, create, update, delete: if true;
      
      // Nested collections inherit parent permissions
      match /projects/{projectId} {
        allow read, write: if true;
        
        match /fixes/{fixId} {
          allow read, write: if true;
        }
        
        match /principles/{principleId} {
          allow read, write: if true;
        }
      }
    }
  }
}
